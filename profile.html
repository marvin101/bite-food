<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Tasty Bites</title>
    <!-- Add Bootstrap CSS so utility classes like .d-flex work -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="profile.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>Profile</h3>
                <!-- in-sidebar hamburger removed on purpose (mobile uses floating button) -->
            </div>
            <ul class="list-unstyled components">
                <li><a href="dashboard.php"><i class="bi bi-house"></i> Home</a></li>
                <li><a href="profile.php"><i class="bi bi-person"></i> Profile</a></li>
                <li><a href="settings.php"><i class="bi bi-gear"></i> Settings</a></li>
                <li><a href="logout.php"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
            </ul>
        </nav>

        <!-- Sidebar overlay for mobile -->
        <div id="sidebarOverlay" class="sidebar-overlay" style="display:none;"></div>

        <!-- Main Content -->
        <div id="content">
            <!-- Mobile hamburger button (visible on small screens) -->
            <button id="sidebarCollapse" class="mobile-hamburger btn btn-outline-secondary" type="button" aria-label="Toggle sidebar">
                <i class="bi bi-list"></i>
            </button>

            <div class="profile-container">
                <a href="index.html" class="logo-link d-block text-center mb-3">
                    <img src="logo.png" alt="Tasty Bite logo" style="height:32px;width:auto;">
                </a>
                <h1>My Profile</h1>
                <div class="profile-card">
                    <img src="{{PROFILE_IMG}}" alt="Profile Picture" class="profile-img">
                    <h2>{{USERNAME}}</h2>
                    <p><strong>Email:</strong> <span id="profileEmail">{{EMAIL}}</span></p>
                    <p><strong>Region:</strong> <span id="profileRegion">{{REGION}}</span></p>
                </div>

                <!-- Liked recipes injected by profile.php -->
                <div class="liked-recipes-panel mb-4">
                    <h4>Your Liked Recipes</h4>
                    <div id="likedRecipes">
                        {{LIKED_RECIPES}}
                    </div>
                </div>

                <!-- Update form -->
                <form action="profile.php" method="POST" enctype="multipart/form-data" class="update-profile-form" autocomplete="off">
                    <label for="username">Change Username</label>
                    <input type="text" id="username" name="username" class="form-control mb-2" value="{{USERNAME}}" placeholder="Enter new username">

                    <label for="email">Change Email</label>
                    <input type="email" id="email" name="email" class="form-control mb-2" value="{{EMAIL}}" required>

                    <label for="region">Region</label>
                    <div class="region-autocomplete" style="position:relative;">
                        <input type="text" id="region" name="region" class="form-control mb-2" value="{{REGION}}" placeholder="Start typing a country or region" aria-autocomplete="list" aria-haspopup="true" />
                        <ul id="regionSuggestions" class="list-group region-suggestions" role="listbox" aria-label="Region suggestions"></ul>
                    </div>

                    <label for="profile_pic">Change Profile Picture</label>
                    <input type="file" id="profile_pic" name="profile_pic" class="form-control mb-3" accept="image/*">

                    <button type="submit" class="btn btn-primary w-100">Update Profile</button>
                </form>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>

    <script>
    // filepath (inline): e:\Program Files\htdocs\bite-food\profile.html
    // Simple region autocomplete (debounced). Expand `REGIONS` as needed.
    (function() {
      const REGIONS = [
        "Afghanistan","Albania","Algeria","Andorra","Angola","Argentina","Armenia","Australia","Austria","Azerbaijan",
        "Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia",
        "Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burundi",
        "Cambodia","Cameroon","Canada","Cape Verde","Central African Republic","Chad","Chile","China","Colombia","Comoros",
        "Costa Rica","Croatia","Cuba","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic",
        "Ecuador","Egypt","El Salvador","Estonia","Eswatini","Ethiopia",
        "Fiji","Finland","France",
        "Gabon","Gambia","Georgia","Germany","Ghana","Greece","Grenada","Guatemala","Guinea","Guyana",
        "Haiti","Honduras","Hungary",
        "Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy",
        "Jamaica","Japan","Jordan",
        "Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan",
        "Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg",
        "Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Mauritania","Mauritius","Mexico","Micronesia","Moldova","Monaco","Mongolia","Montenegro","Morocco","Mozambique","Myanmar",
        "Namibia","Nauru","Nepal","Netherlands","New Zealand","Nicaragua","Niger","Nigeria","North Korea","North Macedonia","Norway",
        "Oman",
        "Pakistan","Palau","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal",
        "Qatar",
        "Romania","Russia","Rwanda",
        "Saint Kitts and Nevis","Saint Lucia","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Korea","South Sudan","Spain","Sri Lanka","Sudan","Suriname","Sweden","Switzerland","Syria",
        "Taiwan","Tajikistan","Tanzania","Thailand","Togo","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan","Tuvalu",
        "Uganda","Ukraine","United Arab Emirates","United Kingdom","United States","Uruguay","Uzbekistan",
        "Vanuatu","Vatican City","Venezuela","Vietnam",
        "Yemen",
        "Zambia","Zimbabwe"
      ];

      const input = document.getElementById('region');
      const list = document.getElementById('regionSuggestions');
      if (!input || !list) return;

      function debounce(fn, ms) {
        let t;
        return function(...args) {
          clearTimeout(t);
          t = setTimeout(() => fn.apply(this, args), ms);
        };
      }

      function show(listItems) {
        list.innerHTML = '';
        if (!listItems || listItems.length === 0) {
          list.style.display = 'none';
          return;
        }
        listItems.forEach((txt, i) => {
          const li = document.createElement('li');
          li.className = 'list-group-item list-group-item-action';
          li.setAttribute('role','option');
          li.setAttribute('data-value', txt);
          li.textContent = txt;
          li.addEventListener('click', () => {
            input.value = txt;
            list.style.display = 'none';
            input.focus();
          });
          list.appendChild(li);
        });
        list.style.display = 'block';
      }

      function filter(q) {
        if (!q || q.length < 1) { show([]); return; }
        const ql = q.toLowerCase();
        const matches = REGIONS.filter(r => r.toLowerCase().includes(ql));
        show(matches.slice(0, 8));
      }

      const onInput = debounce(function(e) {
        filter(e.target.value.trim());
      }, 150);

      input.addEventListener('input', onInput);

      // keyboard navigation
      input.addEventListener('keydown', function(e) {
        const items = Array.from(list.querySelectorAll('li'));
        const active = list.querySelector('.active');
        let idx = active ? items.indexOf(active) : -1;
        if (e.key === 'ArrowDown') {
          e.preventDefault();
          idx = Math.min(items.length - 1, idx + 1);
          if (items[idx]) {
            items.forEach(it => it.classList.remove('active'));
            items[idx].classList.add('active');
            items[idx].scrollIntoView({block:'nearest'});
          }
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          idx = Math.max(0, idx - 1);
          if (items[idx]) {
            items.forEach(it => it.classList.remove('active'));
            items[idx].classList.add('active');
            items[idx].scrollIntoView({block:'nearest'});
          }
        } else if (e.key === 'Enter') {
          const sel = list.querySelector('.active') || list.querySelector('li');
          if (sel) {
            e.preventDefault();
            input.value = sel.getAttribute('data-value');
            list.style.display = 'none';
          }
        } else if (e.key === 'Escape') {
          list.style.display = 'none';
        }
      });

      // hide on outside click
      document.addEventListener('click', function(ev) {
        if (!input.contains(ev.target) && !list.contains(ev.target)) {
          list.style.display = 'none';
        }
      });

      // ensure initial visibility off
      list.style.display = 'none';
    })();
    </script>
</body>
</html>
